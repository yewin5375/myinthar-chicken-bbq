<!DOCTYPE html>
<html lang="my">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ— á€™á€¼á€„á€ºá€á€¬á€€á€¼á€€á€ºá€€á€„á€º - Premium POS & Admin</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <link href="https://fonts.googleapis.com/css2?family=Pyidaungsu:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root { --gold: #D4AF37; --dark: #121212; --orange: #ff6b00; --card: #ffffff; }
        body { font-family: 'Pyidaungsu', sans-serif; background: #f0f2f5; margin: 0; padding-bottom: 80px; }
        
        /* Navigation Tabs */
        .nav-tabs { display: flex; background: var(--dark); position: sticky; top: 0; z-index: 1000; }
        .tab-btn { flex: 1; padding: 15px; border: none; background: none; color: white; cursor: pointer; font-weight: bold; }
        .tab-btn.active { border-bottom: 3px solid var(--gold); color: var(--gold); }

        .container { max-width: 600px; margin: auto; padding: 15px; }
        .section { display: none; }
        .section.active { display: block; }

        /* Premium Card Design */
        .card { background: var(--card); border-radius: 18px; padding: 15px; margin-bottom: 15px; box-shadow: 0 4px 12px rgba(0,0,0,0.08); position: relative; overflow: hidden; }
        .item-img { width: 100%; height: 180px; object-fit: cover; border-radius: 12px; margin-bottom: 10px; }
        .badge { position: absolute; top: 10px; right: 10px; background: var(--orange); color: white; padding: 4px 10px; border-radius: 20px; font-size: 12px; }

        /* Admin Form */
        .admin-form { background: white; padding: 20px; border-radius: 20px; margin-bottom: 20px; }
        input, select { width: 100%; padding: 12px; margin: 8px 0; border: 1px solid #ddd; border-radius: 10px; box-sizing: border-box; }
        .btn-main { width: 100%; padding: 15px; border: none; border-radius: 12px; background: var(--dark); color: white; font-weight: bold; cursor: pointer; margin-top: 10px; }
        .btn-delete { background: #ff4d4d; color: white; border: none; padding: 8px 15px; border-radius: 8px; margin-top: 10px; }

        /* Checkout Bar */
        .footer-bar { position: fixed; bottom: 0; width: 100%; max-width: 600px; background: var(--dark); padding: 15px 20px; box-sizing: border-box; display: flex; justify-content: space-between; align-items: center; color: white; border-radius: 20px 20px 0 0; left: 50%; transform: translateX(-50%); }
    </style>
</head>
<body>

<div class="nav-tabs">
    <button class="tab-btn active" onclick="showTab('customer')">ğŸ› Menu</button>
    <button class="tab-btn" onclick="showTab('admin')">ğŸ›  Admin</button>
</div>

<div id="customer" class="section active container">
    <h2 style="text-align:center;">âœ¨ á€™á€¼á€„á€ºá€á€¬á€€á€¼á€€á€ºá€€á€„á€º</h2>
    <div id="customer-menu">á€™á€®á€”á€°á€¸á€™á€»á€¬á€¸ á€†á€½á€²á€šá€°á€”á€±á€á€Šá€º...</div>
</div>

<div id="admin" class="section container">
    <div class="admin-form">
        <h3>â• Menu á€¡á€á€…á€ºá€‘á€Šá€·á€ºá€›á€”á€º</h3>
        <input type="text" id="adm-name" placeholder="á€¡á€™á€Šá€º (á€¥á€•á€™á€¬- áá€á€±á€¬á€„á€ºá€¸á€á€”á€ºá€†á€•á€º)">
        <input type="number" id="adm-price" placeholder="á€ˆá€±á€¸á€”á€¾á€¯á€”á€ºá€¸">
        <input type="number" id="adm-stock" placeholder="Stock á€¡á€›á€±á€¡á€á€½á€€á€º">
        <select id="adm-cat">
            <option value="single">á€›á€­á€¯á€¸á€›á€­á€¯á€¸</option>
            <option value="10000_set">á á€á€±á€¬á€„á€ºá€¸á€á€”á€º Set</option>
            <option value="20000_set">á‚ á€á€±á€¬á€„á€ºá€¸á€á€”á€º Set</option>
        </select>
        <label>á€“á€¬á€á€ºá€•á€¯á€¶á€á€„á€ºá€›á€”á€º:</label>
        <input type="file" id="adm-file" accept="image/*">
        <button class="btn-main" onclick="handleSaveItem()">Menu á€á€­á€™á€ºá€¸á€™á€Šá€º</button>
    </div>
    <hr>
    <h3>ğŸ“‹ á€œá€€á€ºá€›á€¾á€­ Menu á€™á€»á€¬á€¸</h3>
    <div id="admin-menu-list"></div>
</div>

<div class="footer-bar" id="cart-bar">
    <div>Total: <b id="total-price">0</b> K</div>
    <button style="background:var(--gold); border:none; padding:10px 20px; border-radius:10px; font-weight:bold;" onclick="alert('Viber/Telegram á€á€­á€¯á€· á€•á€­á€¯á€·á€›á€”á€º á€œá€¯á€•á€ºá€†á€±á€¬á€„á€ºá€á€»á€€á€º...')">Check Out</button>
</div>

<script>
    const SB_URL = "https://iogpnvljnhsxuzzdltpb.supabase.co";
    const SB_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImlvZ3BudmxqbmhzeHV6emRsdHBiIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjY3NTk2MDYsImV4cCI6MjA4MjMzNTYwNn0.Kxy3QW1gq-J-tzUF2fxQd0l989Wr7BI2uRTbWDTNL6k";
    const _supabase = window.supabase.createClient(SB_URL, SB_KEY);

    let menuItems = [];

    // áá‹ Tab á€•á€¼á€±á€¬á€„á€ºá€¸á€œá€²á€á€¼á€„á€ºá€¸
    function showTab(tab) {
        document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
        document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
        document.getElementById(tab).classList.add('active');
        event.currentTarget.classList.add('active');
        if(tab === 'admin') document.getElementById('cart-bar').style.display = 'none';
        else document.getElementById('cart-bar').style.display = 'flex';
    }

    // á‚á‹ Menu á€–á€á€ºá€á€¼á€„á€ºá€¸ (Realtime)
    async function fetchMenu() {
        const { data } = await _supabase.from('menu_items').select('*').order('created_at', {ascending: false});
        menuItems = data || [];
        renderCustomerMenu();
        renderAdminMenu();
    }

    function renderCustomerMenu() {
        const div = document.getElementById('customer-menu');
        div.innerHTML = menuItems.map(item => `
            <div class="card">
                ${item.image_url ? `<img src="${item.image_url}" class="item-img">` : ''}
                <div class="badge">${item.category.replace('_', ' ')}</div>
                <div style="font-weight:bold; font-size:18px;">${item.name}</div>
                <div style="color:var(--orange); font-weight:bold;">${item.price.toLocaleString()} K</div>
                <div style="font-size:12px; color:gray;">á€œá€€á€ºá€€á€»á€”á€º: ${item.stock_qty}</div>
                <button class="btn-main" style="padding:10px;" onclick="addToCart('${item.id}')">ğŸ›’ á€™á€¾á€¬á€šá€°á€™á€Šá€º</button>
            </div>
        `).join('');
    }

    function renderAdminMenu() {
        const div = document.getElementById('admin-menu-list');
        div.innerHTML = menuItems.map(item => `
            <div class="card" style="display:flex; gap:10px; align-items:center;">
                <img src="${item.image_url}" style="width:60px; height:60px; border-radius:8px; object-fit:cover;">
                <div style="flex:1;">
                    <b>${item.name}</b><br>
                    <small>${item.price} K | Stock: ${item.stock_qty}</small>
                </div>
                <button class="btn-delete" onclick="deleteItem('${item.id}')">á€–á€»á€€á€ºá€™á€Šá€º</button>
            </div>
        `).join('');
    }

    // áƒá‹ Admin: Menu á€¡á€á€…á€ºá€‘á€Šá€·á€ºá€á€¼á€„á€ºá€¸ + Image Upload
    async function handleSaveItem() {
        const file = document.getElementById('adm-file').files[0];
        const name = document.getElementById('adm-name').value;
        const price = document.getElementById('adm-price').value;
        const stock = document.getElementById('adm-stock').value;
        const cat = document.getElementById('adm-cat').value;

        if(!file || !name) return alert("á€¡á€á€»á€€á€ºá€¡á€œá€€á€º á€•á€¼á€Šá€·á€ºá€…á€¯á€¶á€¡á€±á€¬á€„á€º á€–á€¼á€Šá€·á€ºá€•á€«á‹");

        // Image Upload to Supabase Storage
        const fileName = `${Date.now()}_${file.name}`;
        const { data: upData, error: upErr } = await _supabase.storage.from('menu-images').upload(fileName, file);
        if(upErr) return alert("Upload Error: " + upErr.message);

        const { data: urlData } = _supabase.storage.from('menu-images').getPublicUrl(fileName);
        const imageUrl = urlData.publicUrl;

        // Save to Database
        await _supabase.from('menu_items').insert([{ name, price, stock_qty: stock, category: cat, image_url: imageUrl }]);
        alert("á€á€­á€™á€ºá€¸á€†á€Šá€ºá€¸á€•á€¼á€®á€¸á€•á€«á€•á€¼á€®");
        fetchMenu();
    }

    // á„á‹ Admin: Delete
    async function deleteItem(id) {
        if(confirm("á€–á€»á€€á€ºá€™á€¾á€¬ á€á€±á€á€»á€¬á€•á€«á€á€œá€¬á€¸?")) {
            await _supabase.from('menu_items').delete().eq('id', id);
            fetchMenu();
        }
    }

    // Realtime Sync
    _supabase.channel('any').on('postgres_changes', { event: '*', table: 'menu_items' }, fetchMenu).subscribe();

    window.onload = fetchMenu;
</script>
</body>
</html>
