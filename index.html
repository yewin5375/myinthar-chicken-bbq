<!DOCTYPE html>
<html lang="my">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MYIN THAR ROAST</title>
    
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700&family=Pyidaungsu:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">

    <style>
        /* (á‚) Premium Luxury Theme CSS */
        :root {
            --gold: #D4AF37;
            --dark-gold: #996515;
            --black: #0F0F0F;
            --dark-grey: #1C1C1C;
            --white: #F5F5F5;
            --luxury-gradient: linear-gradient(145deg, #D4AF37, #996515);
        }

        body {
            font-family: 'Pyidaungsu', sans-serif;
            background-color: var(--black);
            color: var(--white);
            margin: 0;
            padding-bottom: 100px;
            overflow-x: hidden;
        }

        /* Luxury Header */
        .header {
            background: rgba(15, 15, 15, 0.95);
            padding: 20px;
            display: flex;
            align-items: center;
            border-bottom: 1px solid var(--dark-gold);
            position: sticky;
            top: 0;
            z-index: 1000;
            backdrop-filter: blur(10px);
        }

        .header h1 {
            font-family: 'Playfair Display', serif;
            color: var(--gold);
            margin: 0;
            font-size: 20px;
            letter-spacing: 2px;
            text-transform: uppercase;
        }

        /* Premium Menu Cards */
        .menu-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            padding: 15px;
        }

        .menu-card {
            background: var(--dark-grey);
            border-radius: 20px;
            overflow: hidden;
            border: 1px solid #333;
            transition: transform 0.3s ease;
            position: relative;
        }

        .menu-card:active { transform: scale(0.95); }

        .menu-card img {
            width: 100%;
            height: 140px;
            object-fit: cover;
            filter: brightness(0.9);
        }

        .card-info { padding: 12px; }

        .price-tag {
            color: var(--gold);
            font-weight: bold;
            font-size: 16px;
            margin: 5px 0;
        }

        /* Floating Checkout Bar */
        .footer-bar {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            width: 90%;
            max-width: 500px;
            background: rgba(28, 28, 28, 0.9);
            border: 1px solid var(--gold);
            border-radius: 50px;
            padding: 10px 25px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            backdrop-filter: blur(15px);
            z-index: 1001;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }

        /* Luxury Inputs */
        input, select, textarea {
            background: #252525 !important;
            border: 1px solid #444 !important;
            color: white !important;
            padding: 15px !important;
            border-radius: 12px !important;
            margin: 10px 0;
            width: 100%;
            box-sizing: border-box;
        }

        .btn-gold {
            background: var(--luxury-gradient);
            color: black;
            font-weight: bold;
            border: none;
            padding: 15px;
            border-radius: 12px;
            cursor: pointer;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        /* Premium Voucher Design */
        #invoice-card {
            background: #fff;
            color: #000;
            padding: 40px;
            width: 350px;
            border: 10px double var(--gold);
            position: relative;
            font-family: 'Courier New', Courier, monospace;
        }
     .viber-bg { background: #7360f2; }
        .tele-bg { background: #0088cc; }
        .voucher-header { border-bottom: 2px solid #000; margin-bottom: 20px; }
    </style>
</head>
<body>

<audio id="clickSound" src="https://www.fesliyanstudios.com/play-mp3/387"></audio>
<audio id="successSound" src="https://www.fesliyanstudios.com/play-mp3/2653"></audio>

<div id="overlay" class="overlay" onclick="closeNav()"></div>

<div class="header">
    <div class="burger" onclick="openNav()"><i class="fas fa-bars" style="color:var(--gold)"></i></div>
    <h1>MYIN THAR ROAST</h1>
    <p style="font-size: 13px; opacity: 0.9;">á€›á€á€¬á€…á€¯á€¶á€œá€„á€º á€¡á€€á€„á€ºá€…á€¯á€¶</p>
    <p style="font-size: 13px; opacity: 0.9;">á€™á€„á€ºá€¹á€‚á€œá€¬á€•á€«! á€™á€¼á€„á€ºá€á€¬á€€á€¼á€€á€ºá€€á€„á€º á€™á€¾ á€€á€¼á€­á€¯á€†á€­á€¯á€•á€«á€á€šá€ºá‹
á€œá€á€ºá€†á€á€ºá€•á€¼á€®á€¸ á€¡á€›á€á€¬á€›á€¾á€­á€á€²á€· á€€á€¼á€€á€ºá€€á€„á€ºá€•á€°á€•á€°á€œá€±á€¸á€á€½á€±á€€á€­á€¯ á€á€¯á€¶á€¸á€†á€±á€¬á€„á€ºá€”á€­á€¯á€„á€ºá€•á€«á€•á€¼á€®á‹
ğŸ“ á€†á€­á€¯á€„á€ºá€á€­á€¯á€œá€¬á€›á€±á€¬á€€á€ºá€šá€°á€›á€”á€ºá€á€¬ (Pick Up Only)
ğŸ“ Phone/Viber: 09767287345</p>
</div>

<div class="container">
    
    <div id="page-customer" class="section active">
        <div id="menu-display" class="menu-grid"></div>
    </div>

    <div id="page-admin" class="section" style="padding:20px;">
        <h2 style="color:var(--gold)">Admin Portal</h2>
        <div class="admin-form">
            <input type="text" id="add-name" placeholder="Menu Item Name">
            <input type="number" id="add-price" placeholder="Price (MMK)">
            <textarea id="add-desc" placeholder="Set details / Description"></textarea>
            <input type="file" id="add-img">
            <button class="btn-gold" style="width:100%" onclick="uploadMenu()">Add Premium Item</button>
        </div>
        <div id="admin-orders-list" style="margin-top:30px;"></div>
    </div>

</div>

<div class="footer-bar">
    <div>Total: <span id="total-price" style="color:var(--gold); font-size:20px;">0</span> K</div>
    <button class="btn-gold" style="padding:10px 30px; border-radius:30px;" onclick="playSound('clickSound'); openCheckout()">Checkout</button>
</div>

<div id="checkout-modal" class="modal" style="display:none; position:fixed; top:0; background:rgba(0,0,0,0.9); width:100%; height:100%; z-index:9999; display:flex; align-items:center; justify-content:center;">
    <div style="background:var(--dark-grey); padding:30px; border-radius:25px; width:85%; max-width:400px; border:1px solid var(--gold);">
        <h2 style="color:var(--gold); text-align:center;">Reservation Details</h2>
        <input type="text" id="cust-name" placeholder="Full Name">
        <input type="tel" id="cust-phone" placeholder="Phone Number">
        <input type="datetime-local" id="pickup-time">
        <button class="btn-gold" style="width:100%; margin-top:10px;" onclick="submitOrder('viber')">Order via Viber</button>
        <button onclick="closeModal('checkout-modal')" style="background:none; border:none; color:grey; width:100%; margin-top:15px;">Cancel</button>
     <button class="app-btn tele-bg" onclick="submitOrder('telegram')">
            ğŸ”µ Telegram á€–á€¼á€„á€·á€º á€á€­á€¯á€€á€ºá€›á€­á€¯á€€á€ºá€•á€­á€¯á€·á€™á€Šá€º
        </button>

        <div class="guide-box" id="viber-guide" style="display:none;">
            <b>ğŸ’¡ Viber á€–á€¼á€„á€·á€º á€•á€­á€¯á€·á€”á€Šá€ºá€¸á€œá€™á€ºá€¸á€Šá€½á€¾á€”á€º:</b><br>
            áá‹ á€á€œá€¯á€á€ºá€”á€¾á€­á€•á€ºá€œá€­á€¯á€€á€ºá€œá€»á€¾á€„á€º á€¡á€±á€¬á€ºá€’á€«á€…á€¬á€á€¬á€¸á€™á€»á€¬á€¸á€€á€­á€¯ Copy á€¡á€œá€­á€¯á€¡á€œá€»á€±á€¬á€€á€º á€šá€°á€á€½á€¬á€¸á€•á€«á€™á€Šá€ºá‹<br>
            á‚á‹ Viber á€•á€½á€„á€·á€ºá€œá€¬á€•á€«á€€ á€†á€­á€¯á€„á€ºá€›á€¾á€„á€º Chat á€‘á€²á€á€½á€„á€º á€á€á€–á€­á€”á€¾á€­á€•á€ºá€•á€¼á€®á€¸ <b>Paste (á€€á€°á€¸á€‘á€Šá€·á€º)</b> á€œá€¯á€•á€ºá á€•á€­á€¯á€·á€•á€±á€¸á€•á€«á‹
        </div>
        
        <div class="notice">âš ï¸ á€¡á€±á€¬á€ºá€’á€«á€á€„á€ºá€•á€¼á€®á€¸á€•á€«á€€ <b>09767287345</b> á€á€­á€¯á€· <br>á€–á€¯á€”á€ºá€¸á€–á€¼á€„á€·á€º á€¡á€€á€¼á€±á€¬á€„á€ºá€¸á€€á€¼á€¬á€¸á€•á€±á€¸á€•á€«á‹</div>
        <button onclick="closeCheckout()" style="width:100%; border:none; background:none; color:#94a3b8; margin-top:15px; cursor:pointer;">á€™á€™á€¾á€¬á€á€±á€¸á€•á€« (á€•á€­á€á€ºá€™á€Šá€º)</button>
    </div>
</div>

<div id="voucher-wrap" style="position:absolute; left:-9999px;">
    <div id="invoice-card">
        <div class="voucher-header">
            <h2>MYIN THAR ROAST</h2>
            <p>Order ID: #<span id="v-id"></span></p>
        </div>
        <p><b>Date:</b> <span id="v-date"></span></p>
        <p><b>Customer:</b> <span id="v-name"></span></p>
        <div id="v-items" style="margin:20px 0; min-height:100px;"></div>
        <div style="border-top:2px solid #000; padding-top:10px; text-align:right;">
            <h3>Total: <span id="v-total"></span> MMK</h3>
        </div>
        <p style="text-align:center; font-size:10px; margin-top:30px;">Thank you for choosing premium quality.</p>
    </div>
</div>

<script>
    // (áƒ) Supabase Connection
    const SB_URL = "https://iogpnvljnhsxuzzdltpb.supabase.co";
    const SB_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImlvZ3BudmxqbmhzeHV6emRsdHBiIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjY3NTk2MDYsImV4cCI6MjA4MjMzNTYwNn0.Kxy3QW1gq-J-tzUF2fxQd0l989Wr7BI2uRTbWDTNL6k";
    const _supabase = window.supabase.createClient(SB_URL, SB_KEY);

    const MY_PHONE = "959767287345";
    
    let cart = {};
    let allItems = [];

    // Sound Logic
    function playSound(id) { document.getElementById(id).play(); }

    window.onload = () => {
        fetchMenu();
        document.getElementById('checkout-modal').style.display = 'none';
    };

    async function fetchMenu() {
        const { data } = await _supabase.from('menu_items').select('*');
        allItems = data || [];
        renderMenu(allItems);
    }

    function renderMenu(items) {
        document.getElementById('menu-display').innerHTML = items.map(i => `
            <div class="menu-card">
                <img src="${i.image_url}" alt="${i.name}">
                <div class="card-info">
                    <div style="font-weight:bold; height:40px;">${i.name}</div>
                    <div class="price-tag">${i.price.toLocaleString()} K</div>
                    <div style="display:flex; justify-content:space-between; align-items:center;">
                        <button onclick="updateQty('${i.name}', -1, ${i.price})" style="background:#444; color:white; border:none; border-radius:5px; width:30px; height:30px;">-</button>
                        <span id="qty-${i.name}">0</span>
                        <button onclick="updateQty('${i.name}', 1, ${i.price})" style="background:var(--gold); border:none; border-radius:5px; width:30px; height:30px;">+</button>
                    </div>
                </div>
            </div>
        `).join('');
    }

    function updateQty(name, change, price) {
        playSound('clickSound');
        cart[name] = (cart[name] || 0) + change;
        if (cart[name] < 0) cart[name] = 0;
        document.getElementById(`qty-${name}`).innerText = cart[name];
        
        let total = 0;
        for(let key in cart) {
            let item = allItems.find(i => i.name === key);
            total += cart[key] * item.price;
        }
        document.getElementById('total-price').innerText = total.toLocaleString();
    }

    function openCheckout() { document.getElementById('checkout-modal').style.display = 'flex'; }
    function closeModal(id) { document.getElementById(id).style.display = 'none'; }

    // (á„) Submit Order & Auto-Voucher
    async function submitOrder(platform) {
        const name = document.getElementById('cust-name').value;
        const phone = document.getElementById('cust-phone').value;
        const time = document.getElementById('pickup-time').value;
        const total = document.getElementById('total-price').innerText;

        if(!name || !phone) return alert("Please fill in premium details.");

        let orderItems = [];
        for(let k in cart) { if(cart[k] > 0) orderItems.push(`${k} x ${cart[k]}`); }

        // Hidden Database Logging
        const { data, error } = await _supabase.from('orders').insert([{
            customer_name: name,
            phone: phone,
            items: orderItems.join(", "),
            total: total,
            status: 'pending'
        }]).select();

        if(!error) {
            playSound('successSound');
            const orderId = data[0].id;
            
            // Set Voucher Data
            document.getElementById('v-id').innerText = orderId;
            document.getElementById('v-name').innerText = name;
            document.getElementById('v-total').innerText = total;
            document.getElementById('v-date').innerText = new Date().toLocaleString();
            document.getElementById('v-items').innerHTML = orderItems.join("<br>");

            // Generate Image and Download
            setTimeout(() => {
                html2canvas(document.querySelector("#invoice-card"), { useCORS: true }).then(canvas => {
                    const link = document.createElement('a');
                    link.download = `Premium_Order_${orderId}.png`;
                    link.href = canvas.toDataURL("image/png");
                    link.click();
                });
            }, 500);

            // Redirect to Messaging
            const msg = `ğŸ”¥ PREMIUM ORDER ğŸ”¥\nID: #${orderId}\nCustomer: ${name}\nPhone: ${phone}\nTime: ${time}\nItems: ${orderItems.join(", ")}\nTotal: ${total} MMK`;
            window.location.href = `viber://forward?text=${encodeURIComponent(msg)}`;
        } else {
            alert("Order failed to reach dashboard. Check internet.");
        }
    }

     if (sendVia === 'viber') {
            // Viber á€¡á€á€½á€€á€º á€…á€¬á€á€¬á€¸á€€á€­á€¯ Copy á€šá€°á€á€¼á€„á€ºá€¸
            navigator.clipboard.writeText(msg).then(() => {
                alert("á€¡á€±á€¬á€ºá€’á€«á€…á€¬á€á€¬á€¸á€€á€­á€¯ Copy á€šá€°á€•á€¼á€®á€¸á€•á€«á€•á€¼á€®á‹ Viber á€•á€½á€„á€·á€ºá€œá€¬á€•á€«á€€ á€†á€­á€¯á€„á€ºá€›á€¾á€„á€º Chat á€‘á€²á€á€½á€„á€º Paste á€œá€¯á€•á€ºá á€•á€­á€¯á€·á€•á€±á€¸á€•á€«á‹");
                window.location.href = `viber://contact?number=${MY_PHONE}`;
            }).catch(err => {
                // Clipboard error backup
                window.location.href = `viber://contact?number=${MY_PHONE}&draft=${encodeURIComponent(msg)}`;
            });
        } else {
            // Telegram á€¡á€á€½á€€á€º Direct Send Link
            const teleMsg = msg.replace(/\*/g, ''); // Telegram link formats can be sensitive
            window.location.href = `https://t.me/+${MY_PHONE}?text=${encodeURIComponent(msg)}`;
        }
    }
    // Admin Sidebar Toggle
    function openNav() { document.getElementById("page-admin").classList.toggle('active'); }
</script>
</body>
</html>
